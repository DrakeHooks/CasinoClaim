var acsRequestManager=function(){"use strict";var t,e,s,i,n=function(){this.stopSendingRequests=!1,this.urlToProcess="",this.unresolvedRequests=[],this.globalTimeout=2500,this.timeoutBetweenRequests=350,this.metrics={waitCounter:0,averageXhrLatency:0,mainFrameRequestProcessingTime:0,callCount:{ok:0,nonOk:0}}};n.prototype.cancelAll=function(){var t;if(this.stopSendingRequests=!0,0!==this.unresolvedRequests.length)for(t=0;t<this.unresolvedRequests.length;t++){var e=this.unresolvedRequests[t];e[0];e[1].abort()}},n.prototype.dispatch=function(e,s,i,n){t=Date.now();var a=adawareUtils.generateRandomNumber(),r=adawareUtils.httpGetAsync("https://acs.lavasoft.com/api/v2.0/url/classify?"+e,s.bind(this),i.bind(this));r.urlToVerify=this.urlToProcess,r.requestID=a,this.unresolvedRequests.push([a,r])},n.prototype.send=function(n,a,r,o,u){s=Date.now();var c=decodeURIComponent(n.substring(4));this.urlToProcess=c;setTimeout(function(){this.cancelAll()}.bind(this),this.globalTimeout);var h=function(t,e,n){i=Date.now(),this.metrics.mainFrameRequestProcessingTime=i-s,o&&e(t,"ACS-Blacklist",!0),n(this.metrics)},l=function(c,v){e=Date.now(),this.metrics.callCount.ok++;var f=e-t;this.metrics.averageXhrLatency=adawareUtils.computeMovingAverage(this.metrics.callCount.ok+this.metrics.callCount.nonOk,this.metrics.averageXhrLatency,f);var g=JSON.parse(c),p=(this.unresolvedRequests.shift()[0],g.status),R=g.isSafe;"wait"===p?(this.metrics.waitCounter++,this.metrics.waitCounter<3?setTimeout(function(){!1===this.stopSendingRequests&&this.dispatch(n,l.bind(this),m.bind(this),d.bind(this))}.bind(this),this.timeoutBetweenRequests):h.call(this,n,a,u)):(i=Date.now(),this.metrics.mainFrameRequestProcessingTime=i-s,u(this.metrics),"found"===p||"true"===p||!0===p?"false"===R||!1===R?a(n,"ACS-Query",o):o&&r(n):"false"!==p&&!1!==p||o&&r(n))},m=function(){e=Date.now(),this.metrics.callCount.nonOk++;var s=e-t;this.metrics.averageXhrLatency=adawareUtils.computeMovingAverage(this.metrics.callCount.ok+this.metrics.callCount.nonOk,this.metrics.averageXhrLatency,s);this.unresolvedRequests.shift()[0];h.call(this,n,a,u)},d=function(){this.unresolvedRequests.shift()[0];h.call(this,n,a,u)};this.dispatch(n,l.bind(this),m.bind(this),d.bind(this))};var a=function(){};return a.prototype.createInstance=function(){return new n},new a}();