"use strict";webSafety.PageStore=function(){var t=webSafety,o=[],e=function(t){this.init(t)};e.factory=function(t){var a=o.pop();return void 0===a?new e(t):a.init(t)},e.prototype.init=function(o){var e=t.URI;return this.pageHostname=e.hostnameFromURI(o),this.pageDomain=e.domainFromHostname(this.pageHostname)||this.pageHostname,this},e.prototype.dispose=function(){return this.pageHostname=this.pageDomain="",o.length<50&&o.push(this),null};var a=[],n=function(t){this.init(t),this.journal=[],this.journalTimer=null,this.journalLastCommitted=this.journalLastUncommitted=void 0,this.journalLastUncommittedURL=void 0};return n.factory=function(t){var o=a.pop();return void 0===o?o=new n(t):o.init(t),o},n.prototype.init=function(o){var e=t.tabContextManager.mustLookup(o);return this.tabId=o,this.tabHostname=e.rootHostname,this.title=e.rawURL,this.rawURL=e.rawURL,this.hostnameToCountMap=new Map,this.contentLastModified=0,this.frames=Object.create(null),this},n.prototype.reuse=function(o){var e=t.tabContextManager.mustLookup(this.tabId);return e.rootHostname!==this.tabHostname&&(o=""),"tabUpdated"===o?(this.rawURL=e.rawURL,this):(this.disposeFrameStores(),this.init(this.tabId),this)},n.prototype.dispose=function(){return this.tabHostname="",this.title="",this.rawURL="",this.hostnameToCountMap=null,this.disposeFrameStores(),null!==this.journalTimer&&(clearTimeout(this.journalTimer),this.journalTimer=null),this.journal=[],this.journalLastUncommittedURL=void 0,a.length<10&&a.push(this),null},n.prototype.disposeFrameStores=function(){var t=this.frames;for(var o in t)t[o].dispose();this.frames=Object.create(null)},n.prototype.getFrame=function(t){return this.frames[t]||null},n.prototype.setFrame=function(t,o){var a=this.frames[t];a?a.init(o):this.frames[t]=e.factory(o)},n.prototype.createContextFromPage=function(){var o=t.tabContextManager.createContext(this.tabId);return o.pageHostname=o.rootHostname,o.pageDomain=o.rootDomain,o},n.prototype.createContextFromFrameId=function(o){var e=t.tabContextManager.createContext(this.tabId),a=this.frames[o];return a?(e.pageHostname=a.pageHostname,e.pageDomain=a.pageDomain):(e.pageHostname=e.rootHostname,e.pageDomain=e.rootDomain),e},n.prototype.createContextFromFrameHostname=function(o){var e=t.tabContextManager.createContext(this.tabId);return e.pageHostname=o,e.pageDomain=t.URI.domainFromHostname(o)||o,e},n.prototype.journalAddRootFrame=function(t,o){"committed"===t?(this.journalLastCommitted=this.journal.length,void 0!==this.journalLastUncommitted&&this.journalLastUncommitted<this.journalLastCommitted&&this.journalLastUncommittedURL===o&&(this.journalLastCommitted=this.journalLastUncommitted,this.journalLastUncommitted=void 0)):"uncommitted"===t&&(this.journalLastUncommitted=this.journal.length,this.journalLastUncommittedURL=o),null!==this.journalTimer&&clearTimeout(this.journalTimer),this.journalTimer=vAPI.setTimeout(this.journalProcess.bind(this,!0),1e3)},n.prototype.journalProcess=function(t){t||clearTimeout(this.journalTimer),this.journalTimer=null;var o,e,a,n,i=this.journal,r=i.length,s=Date.now();for(o=this.journalLastCommitted||0;o<r;o+=2)e=i[o],void 0===(n=this.hostnameToCountMap.get(e))&&(n=0,this.contentLastModified=s),a=i[o+1],this.hostnameToCountMap.set(e,n+a);this.journalLastCommitted=void 0,i.length=0},{factory:n.factory}}();