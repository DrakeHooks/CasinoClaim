!function(){"use strict";var t,e,i,n,o,a=webSafety;a.normalizePageURL=function(t,e){if(vAPI.isBehindTheSceneTabId(t))return"http://behind-the-scene/";var i=this.URI.set(e),n=i.scheme;if("https"===n||"http"===n)return i.normalizedURI();var o=n+"-scheme";return""!==i.hostname?o=i.hostname+"."+o:"about"===n&&""!==i.path&&(o=i.path+"."+o),"http://"+o+"/"},a.tabContextManager=function(){var t=Object.create(null),e="",i=0,n=function(t,e){this.url=t,this.committed=e,this.tstamp=Date.now()},o=function(e){this.tabId=e.toString(),this.stack=[],this.rawURL=this.normalURL=this.rootHostname=this.rootDomain="",this.commitTimer=null,this.gcTimer=null,this.onGCBarrier=!1,this.lookedUp=!1,t[e]=this};o.prototype.destroy=function(){vAPI.isBehindTheSceneTabId(this.tabId)||(null!==this.gcTimer&&(clearTimeout(this.gcTimer),this.gcTimer=null),delete t[this.tabId])},o.prototype.onTab=function(t){t?this.gcTimer=vAPI.setTimeout(this.onGC.bind(this),6e5):this.destroy()},o.prototype.onGC=function(){vAPI.isBehindTheSceneTabId(this.tabId)||this.onGCBarrier||(this.onGCBarrier=!0,this.gcTimer=null,vAPI.tabs.get(this.tabId,this.onTab.bind(this)),this.onGCBarrier=!1)},o.prototype.onCommit=function(){if(!vAPI.isBehindTheSceneTabId(this.tabId)){this.commitTimer=null;for(var t=this.stack.length;t--&&!this.stack[t].committed;);-1===t&&0!==this.stack.length&&(this.stack[0].committed=!0,t=0),(t+=1)<this.stack.length&&(this.stack.length=t,this.update())}},o.prototype.autodestroy=function(){vAPI.isBehindTheSceneTabId(this.tabId)||(this.gcTimer=vAPI.setTimeout(this.onGC.bind(this),6e5))},o.prototype.update=function(){if(0!==this.stack.length){var t=this.stack[this.stack.length-1];this.rawURL=t.url,this.normalURL=a.normalizePageURL(this.tabId,this.rawURL),this.rootHostname=a.URI.hostnameFromURI(this.normalURL),this.rootDomain=a.URI.domainFromHostname(this.rootHostname)||this.rootHostname}else this.rawURL=this.normalURL=this.rootHostname=this.rootDomain=""},o.prototype.push=function(t){if(!vAPI.isBehindTheSceneTabId(this.tabId)){var e=this.stack.length;0!==e&&this.stack[e-1].url===t||(this.stack.push(new n(t)),this.update(),null!==this.commitTimer&&clearTimeout(this.commitTimer),this.commitTimer=vAPI.setTimeout(this.onCommit.bind(this),500))}},o.prototype.commit=function(t){vAPI.isBehindTheSceneTabId(this.tabId)||(this.stack=[new n(t,!0)],this.update())};var s,r=function(n,a){var s=t[n];return void 0===s&&(s=new o(n)).autodestroy(),s.push(a),e=a,i=Date.now(),s},h=function(e){return t[e]||null};(s=new o(vAPI.noTabId)).stack.push(new n("",!0)),s.rawURL="",s.normalURL=a.normalizePageURL(s.tabId),s.rootHostname=a.URI.hostnameFromURI(s.normalURL),s.rootDomain=a.URI.domainFromHostname(s.rootHostname);var u=[],m=function(t){this.init(t)};m.prototype.init=function(t){var e=h(t);return this.rootHostname=e.rootHostname,this.rootDomain=e.rootDomain,this.pageHostname=this.pageDomain=this.requestURL=this.requestHostname=this.requestDomain="",this},m.prototype.dispose=function(){u.push(this)};return{push:r,commit:function(e,i){var n=t[e];return void 0===n?n=r(e,i):n.commit(i),n},lookup:h,getLookupStatus:function(e){if(t[e])return t[e].lookedUp},mustLookup:function(n){var o=t[n];return void 0!==o?o:(""!==e&&i+500<Date.now()&&(e=""),""!==e?r(n,e):t[vAPI.noTabId])},exists:function(e){return void 0!==t[e]},createContext:function(t){return u.length?u.pop().init(t):new m(t)}}}(),vAPI.tabs.onNavigation=function(t){if(t.url.indexOf("adaware.com")>-1&&"warningPage"===adawareUtils.getParameterByName("source",t.url)&&adawareTelemetry.sendEventTrackingInfo("IframeCTA"),0===t.frameId){a.tabContextManager.commit(t.tabId,t.url);var e=a.bindTabToPageStats(t.tabId,"tabCommitted");e&&e.journalAddRootFrame("committed",t.url)}},vAPI.tabs.onUpdated=function(t,e,i){i.url&&""!==i.url&&e.url&&(a.tabContextManager.commit(t,e.url),a.bindTabToPageStats(t,"tabUpdated"))},vAPI.tabs.onClosed=function(t){vAPI.isBehindTheSceneTabId(t)||(a.unbindTabFromPageStats(t),delete a.warningPageUrls[t])},vAPI.tabs.registerListeners(),a.bindTabToPageStats=function(t,e){if(!1===a.tabContextManager.exists(t))return this.unbindTabFromPageStats(t),null;var i=this.pageStores[t];return i?vAPI.isBehindTheSceneTabId(t)?i:"beforeRequest"===e?i:(i.reuse(e),this.updateTitle(t),this.pageStoresToken=Date.now(),i):(this.updateTitle(t),this.pageStoresToken=Date.now(),this.pageStores[t]=this.PageStore.factory(t))},a.unbindTabFromPageStats=function(t){var e=this.pageStores[t];void 0!==e&&(e.dispose(),delete this.pageStores[t],this.pageStoresToken=Date.now())},a.pageStoreFromTabId=function(t){return this.pageStores[t]||null},a.mustPageStoreFromTabId=function(t){return this.pageStores[t]||this.pageStores[vAPI.noTabId]},a.pageStores[vAPI.noTabId]=a.PageStore.factory(vAPI.noTabId),a.pageStores[vAPI.noTabId].title=vAPI.i18n("logBehindTheScene"),a.updateTitle=(t=Object.create(null),e=Object.create(null),i=function(t){delete e[t]},n=function(i){var n=e[i];return void 0!==n&&(1===n?(delete e[i],!1):(e[i]=n-1,t[i]=vAPI.setTimeout(o.bind(a,i),499),!0))},o=function(e){delete t[e],vAPI.tabs.get(e,function(t,e){if(!e)return i(t);var o=this.pageStoreFromTabId(t);if(null===o)return i(t);if(o.rawURL=e.url,this.pageStoresToken=Date.now(),e.title||!n(t)){var a=e.title&&e.title===o.title;o.title=e.title||e.url||"",this.pageStoresToken=Date.now(),!a&&n(t)||i(t)}}.bind(this,e))},function(i){vAPI.isBehindTheSceneTabId(i)||(t[i]&&clearTimeout(t[i]),t[i]=vAPI.setTimeout(o.bind(this,i),499),e[i]=5)});var s=0,r=function(){var t,e=vAPI.tabs,i=Object.keys(a.pageStores).sort(),n=function(t){e.get(t,function(e){e||a.unbindTabFromPageStats(t)})};s>=i.length&&(s=0);for(var o=Math.min(s+10,i.length),h=s;h<o;h++)t=i[h],vAPI.isBehindTheSceneTabId(t)||n(t);s=o,vAPI.setTimeout(r,9e5)};vAPI.setTimeout(r,9e5)}();