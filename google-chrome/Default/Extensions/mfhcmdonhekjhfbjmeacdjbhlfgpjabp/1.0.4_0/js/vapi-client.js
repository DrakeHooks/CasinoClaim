"use strict";!function(n){if(document instanceof HTMLDocument!=!1||document instanceof XMLDocument!=!1&&document.createElement("div")instanceof HTMLDivElement!=!1){var e=document.contentType||"";if(!/^image\/|^text\/plain/.test(e)){n.vAPI&&!0===n.vAPI.uBO||(n.vAPI={uBO:!0});var t=n.vAPI,i=n.chrome;t.sessionId||(t.randomToken=function(){return String.fromCharCode(Date.now()%26+97)+Math.floor(982451653*Math.random()+982451653).toString(36)},t.sessionId=t.randomToken(),t.chrome=!0,t.setTimeout=t.setTimeout||n.setTimeout.bind(n),t.shutdown={jobs:[],add:function(n){this.jobs.push(n)},exec:function(){for(var n;n=this.jobs.pop();)n()},remove:function(n){for(var e;-1!==(e=this.jobs.indexOf(n));)this.jobs.splice(e,1)}},t.messaging={port:null,portTimer:null,portTimerDelay:1e4,channels:Object.create(null),channelCount:0,pending:Object.create(null),pendingCount:0,auxProcessId:1,shuttingDown:!1,shutdown:function(){this.shuttingDown=!0,this.destroyPort()},disconnectListener:function(){this.port=null,t.shutdown.exec()},disconnectListenerCallback:null,messageListener:function(n){if(n)if(!0!==n.broadcast||n.channelName){if(n.auxProcessId){var e=this.pending[n.auxProcessId];if(delete this.pending[n.auxProcessId],delete n.auxProcessId,e)return this.pendingCount-=1,void e(n.msg)}var t=this.sendToChannelListeners(n.channelName,n.msg);if(void 0!==n.mainProcessId){var i=this.connect();null!==i&&i.postMessage({mainProcessId:n.mainProcessId,msg:t})}}else for(var s in this.channels)this.sendToChannelListeners(s,n.msg)},messageListenerCallback:null,portPoller:function(){if(this.portTimer=null,null!==this.port&&(0!==this.channelCount||0!==this.pendingCount))return this.portTimer=t.setTimeout(this.portPollerCallback,this.portTimerDelay),void(this.portTimerDelay=Math.min(2*this.portTimerDelay,36e5));this.destroyPort()},portPollerCallback:null,destroyPort:function(){null!==this.portTimer&&(clearTimeout(this.portTimer),this.portTimer=null);var n=this.port;if(null!==n&&(n.disconnect(),n.onMessage.removeListener(this.messageListenerCallback),n.onDisconnect.removeListener(this.disconnectListenerCallback),this.port=null),0!==this.channelCount&&(this.channels=Object.create(null),this.channelCount=0),0!==this.pendingCount){var e,t=this.pending;for(var i in this.pending=Object.create(null),this.pendingCount=0,t)"function"==typeof(e=t[i])&&e(null)}},createPort:function(){if(this.shuttingDown)return null;null===this.messageListenerCallback&&(this.messageListenerCallback=this.messageListener.bind(this),this.disconnectListenerCallback=this.disconnectListener.bind(this),this.portPollerCallback=this.portPoller.bind(this));try{this.port=i.runtime.connect({name:t.sessionId})||null}catch(n){this.port=null}return null!==this.port&&(this.port.onMessage.addListener(this.messageListenerCallback),this.port.onDisconnect.addListener(this.disconnectListenerCallback)),this.portTimerDelay=1e4,null===this.portTimer&&(this.portTimer=t.setTimeout(this.portPollerCallback,this.portTimerDelay)),this.port},connect:function(){return null!==this.port?this.port:this.createPort()},send:function(n,e,t){this.sendTo(n,e,void 0,void 0,t)},sendTo:function(n,e,i,s,o){this.pendingCount>25&&t.shutdown.exec();var r,l=this.connect();null!==l?(o&&(r=this.auxProcessId++,this.pending[r]=o,this.pendingCount+=1),l.postMessage({channelName:n,auxProcessId:r,toTabId:i,toChannel:s,msg:e})):"function"==typeof o&&o()},addChannelListener:function(n,e){if("function"==typeof e){var t=this.channels[n];void 0!==t&&-1!==t.indexOf(e)||(void 0===t?(this.channels[n]=[e],this.channelCount+=1):t.push(e),this.connect())}},removeChannelListener:function(n,e){if("function"==typeof e){var t=this.channels[n];if(void 0!==t){var i=t.indexOf(e);-1!==i&&(t.splice(i,1),0===t.length&&(delete this.channels[n],this.channelCount-=1))}}},removeAllChannelListeners:function(n){void 0!==this.channels[n]&&(delete this.channels[n],this.channelCount-=1)},sendToChannelListeners:function(n,e){var t=this.channels[n];if(void 0!==t){for(var i,s=0,o=t.length;s<o&&void 0===(i=t[s](e));s++);return i}}},t.shutdown.add(function(){t.messaging.shutdown(),delete window.vAPI}))}}}(this);